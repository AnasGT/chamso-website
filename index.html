<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ููุตุฉ ุชุนูู ุงููุฑุขู ุงููุฑูู - ุชุนููู ูุชููุฒ ูููุฑุขู ุงููุฑูู</title>
    <meta name="description" content="ููุตุฉ ุชุนููููุฉ ูุชูุงููุฉ ูุชุนูู ูุชุนููู ุงููุฑุขู ุงููุฑูู ุจุฃุญุฏุซ ุงููุณุงุฆู ุงูุชูููุฉ ูุงูููุงูุฌ ุงูุชุฑุจููุฉ ุงููุชุทูุฑุฉ">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:ital,wght@0,400;0,700;1,400;1,700&family=Cairo:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/landing.css">
    <style>
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            position: relative;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            margin: 0 auto;
            right: auto !important; /* Override any RTL positioning */
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Navigation Header -->
        <header class="main-header">
            <nav class="navbar">
                <div class="nav-content">
                    <div class="logo-section">
                        <div class="logo-icon">๐</div>
                        <div class="logo-text">
                            <h1>ููุตุฉ ุชุนูู ุงููุฑุขู ุงููุฑูู</h1>
                            <span class="tagline">ุจูุณููู ุงูููููู ุงูุฑููุญููููู ุงูุฑููุญูููู</span>
                        </div>
                    </div>
                    <div class="nav-actions" id="navActions">
                        <!-- Buttons will be dynamically inserted here -->
                    </div>
                </div>
            </nav>
        </header>

        <!-- Hero Section -->
        <section class="hero-section">
            <div class="hero-content">
                <div class="hero-text">
                    <h2 class="hero-title">
                        <span class="highlight">ุชุนูู ุงููุฑุขู ุงููุฑูู</span>
                        <br>
                        <br>ุจุฃุญุฏุซ ุงููุณุงุฆู ุงูุชุนููููุฉ
                    </h2>
                    <p class="hero-description">
                        ููุตุฉ ุชุนููููุฉ ูุชูุงููุฉ ุชุฌูุน ุจูู ุงูุชูููุฉ ุงูุญุฏูุซุฉ ูุงูููุงูุฌ ุงูุชุฑุจููุฉ ุงูุฃุตููุฉ 
                        ูุชูููุฑ ุชุฌุฑุจุฉ ุชุนููููุฉ ูููุฒุฉ ูู ุชุนูู ูุชุนููู ุงููุฑุขู ุงููุฑูู
                    </p>
                    <div class="hero-stats">
                        <div class="stat-item">
                            <div class="stat-number">1000+</div>
                            <div class="stat-label">ุทุงูุจ ูุณุฌู</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">50+</div>
                            <div class="stat-label">ุฃุณุชุงุฐ ูุนุชูุฏ</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-number">24/7</div>
                            <div class="stat-label">ูุชุงุญ ุฏุงุฆูุงู</div>
                        </div>
                    </div>
                    <div class="hero-actions">
                        <button class="btn btn-primary btn-large" onclick="showRegisterModal()">
                            ุงุจุฏุฃ ุฑุญูุชู ุงูุชุนููููุฉ
                        </button>
                        <button class="btn btn-secondary btn-large" onclick="scrollToFeatures()">
                            ุงูุชุดู ุงููุฒูุฏ
                        </button>
                    </div>
                </div>
                <div class="hero-visual">
                    <div class="quran-illustration">
                        <div class="islamic-pattern-bg"></div>
                        <div class="quran-icon">๐</div>
                        <div class="floating-elements">
                            <div class="element element-1">๐</div>
                            <div class="element element-2">โจ</div>
                            <div class="element element-3">๐ฟ</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Features Section -->
        <section id="features" class="features-section">
            <div class="section-content">
                <div class="section-header">
                    <h3 class="section-title">ูููุฒุงุช ุงูููุตุฉ</h3>
                    <p class="section-subtitle">
                        ูููุฑ ูู ุฃูุถู ุงูุฃุฏูุงุช ูุงููุณุงุฆู ูุชุนูู ุงููุฑุขู ุงููุฑูู ุจุทุฑููุฉ ุนุตุฑูุฉ ููุชุทูุฑุฉ
                    </p>
                </div>
                
                <div class="features-grid">
                    <div class="feature-card">
                        <div class="feature-icon">๐จโ๐</div>
                        <h4>ููุทูุงุจ</h4>
                        <ul class="feature-list">
                            <li>ุชุณุฌูู ุงูุญุถูุฑ ุงููููู</li>
                            <li>ูุชุงุจุนุฉ ุงูุฌุฏูู ุงูุฏุฑุงุณู</li>
                            <li>ุงุณุชูุจุงู ููุงุญุธุงุช ุงูุฃุณุชุงุฐ</li>
                            <li>ุชุชุจุน ุงูุชูุฏู ุงูุฃูุงุฏููู</li>
                        </ul>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">๐จโ๐ซ</div>
                        <h4>ููุฃุณุงุชุฐุฉ</h4>
                        <ul class="feature-list">
                            <li>ุฅุฏุงุฑุฉ ุงูุฌุฏูู ุงูุฏุฑุงุณู</li>
                            <li>ูุชุงุจุนุฉ ุญุถูุฑ ุงูุทูุงุจ</li>
                            <li>ูุชุงุจุฉ ุงูููุงุญุธุงุช ุงูุดุฎุตูุฉ</li>
                            <li>ุฅุญุตุงุฆูุงุช ุดุงููุฉ</li>
                        </ul>
                    </div>
                    
                    <div class="feature-card">
                        <div class="feature-icon">๐</div>
                        <h4>ุงูุฃูุงู ูุงูุฎุตูุตูุฉ</h4>
                        <ul class="feature-list">
                            <li>ุญูุงูุฉ ุงูุจูุงูุงุช ุงูุดุฎุตูุฉ</li>
                            <li>ุชุดููุฑ ุงููุนูููุงุช</li>
                            <li>ุตูุงุญูุงุช ูุญุฏุฏุฉ ููู ูุณุชุฎุฏู</li>
                            <li>ูุณุฎ ุงุญุชูุงุทูุฉ ุขููุฉ</li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>

        <!-- How It Works Section -->
        <section class="how-it-works-section">
            <div class="section-content">
                <div class="section-header">
                    <h3 class="section-title">ููู ุชุนูู ุงูููุตุฉุ</h3>
                    <p class="section-subtitle">
                        ุฎุทูุงุช ุจุณูุทุฉ ููุจุฏุก ูู ุฑุญูุชู ุงูุชุนููููุฉ
                    </p>
                </div>
                
                <div class="steps-container">
                    <div class="step-item">
                        <div class="step-number">1</div>
                        <div class="step-content">
                            <h4>ุฅูุดุงุก ุงูุญุณุงุจ</h4>
                            <p>ุณุฌู ุญุณุงุจุงู ุฌุฏูุฏุงู ุจุงุณุชุฎุฏุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุฃู ุญุณุงุจ ุฌูุฌู</p>
                        </div>
                    </div>
                    
                    <div class="step-item">
                        <div class="step-number">2</div>
                        <div class="step-content">
                            <h4>ุงุฎุชูุงุฑ ุงูุฏูุฑ</h4>
                            <p>ุญุฏุฏ ุฏูุฑู ูู ุงูููุตุฉ: ุทุงูุจ ููุชุนูู ุฃู ุฃุณุชุงุฐ ููุชุฏุฑูุณ</p>
                        </div>
                    </div>
                    <br>
                    <div class="step-item">
                        <div class="step-number">3</div>
                        <div class="step-content">
                            <h4>ุฅููุงู ุงูููู ุงูุดุฎุตู</h4>
                            <p>ุฃุฏุฎู ุจูุงูุงุชู ุงูุดุฎุตูุฉ ูุฅููุงู ุนูููุฉ ุงูุชุณุฌูู</p>
                        </div>
                    </div>
                    
                    <div class="step-item">
                        <div class="step-number">4</div>
                        <div class="step-content">
                            <h4>ุงุจุฏุฃ ุงูุชุนูู</h4>
                            <p>ุงุณุชูุชุน ุจุชุฌุฑุจุฉ ุชุนููููุฉ ูุชููุฒุฉ ููุชุงุจุนุฉ ูุณุชูุฑุฉ</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Benefits Section -->
        <section class="benefits-section">
            <div class="section-content">
                <div class="benefits-grid">
                    <div class="benefits-text">
                        <h3 class="section-title">ููุงุฐุง ุชุฎุชุงุฑ ููุตุชูุงุ</h3>
                        <div class="benefits-list">
                            <div class="benefit-item">
                                <div class="benefit-icon">โญ</div>
                                <div class="benefit-text">
                                    <h4>ุฌูุฏุฉ ุชุนููููุฉ ุนุงููุฉ</h4>
                                    <p>ููุงูุฌ ูุนุชูุฏุฉ ูุฃุณุงุชุฐุฉ ูุคูููู ูุถูุงู ุฃูุถู ุชุฌุฑุจุฉ ุชุนููููุฉ</p>
                                </div>
                            </div>
                            
                            <div class="benefit-item">
                                <div class="benefit-icon">๐ฑ</div>
                                <div class="benefit-text">
                                    <h4>ุณูููุฉ ุงูุงุณุชุฎุฏุงู</h4>
                                    <p>ูุงุฌูุฉ ุจุณูุทุฉ ููุชุฌุงูุจุฉ ุชุนูู ุนูู ุฌููุน ุงูุฃุฌูุฒุฉ</p>
                                </div>
                            </div>
                            
                            <div class="benefit-item">
                                <div class="benefit-icon">๐</div>
                                <div class="benefit-text">
                                    <h4>ูุชุงุจุนุฉ ูุณุชูุฑุฉ</h4>
                                    <p>ุชูุงุฑูุฑ ุฏูุฑูุฉ ูุฅุญุตุงุฆูุงุช ููุตูุฉ ููุชุงุจุนุฉ ุงูุชูุฏู</p>
                                </div>
                            </div>
                            
                            <div class="benefit-item">
                                <div class="benefit-icon">๐ค</div>
                                <div class="benefit-text">
                                    <h4>ุฏุนู ููู ูุชููุฒ</h4>
                                    <p>ูุฑูู ุฏุนู ูุชุฎุตุต ููุณุงุนุฏุชู ูู ุฃู ููุช</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="benefits-visual">
                        <div class="islamic-calligraphy">
                            <div class="calligraphy-text">
                                ููููู ุฑููุจูู ุฒูุฏูููู ุนูููููุง
                            </div>
                            <div class="calligraphy-translation">
                                "ููู ุฑุจู ุฒุฏูู ุนููุงู"
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Testimonials Section -->
        <section class="testimonials-section">
            <div class="section-content">
                <div class="section-header">
                    <h3 class="section-title">ุขุฑุงุก ุงููุณุชุฎุฏููู</h3>
                    <p class="section-subtitle">
                        ูุงุฐุง ูููู ุทูุงุจูุง ูุฃุณุงุชุฐุชูุง ุนู ุงูููุตุฉ
                    </p>
                </div>
                
                <div class="testimonials-grid">
                    <div class="testimonial-card">
                        <div class="testimonial-content">
                            <p>"ููุตุฉ ุฑุงุฆุนุฉ ุณุงุนุฏุชูู ูู ุชูุธูู ุฏุฑูุณู ููุชุงุจุนุฉ ุทูุงุจู ุจุดูู ุฃูุถู. ุงููุงุฌูุฉ ุณููุฉ ูุงูููุฒุงุช ูููุฏุฉ ุฌุฏุงู."</p>
                        </div>
                        <div class="testimonial-author">
                            <div class="author-info">
                                <h4>ุฃูุงู ุฌุบูุจู </h4>
                                <span>ุฃุณุชุงุฐุฉ ูุฑุขู ูุฑูู</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="testimonial-card">
                        <div class="testimonial-content">
                            <p>"ุฃุตุจุญ ุจุฅููุงูู ูุชุงุจุนุฉ ุฌุฏููู ุงูุฏุฑุงุณู ูุชุณุฌูู ุญุถูุฑู ุจุณูููุฉ. ุงูููุตุฉ ุฌุนูุช ุชุนูู ุงููุฑุขู ุฃูุซุฑ ุชูุธููุงู."</p>
                        </div>
                        <div class="testimonial-author">
                            <div class="author-info">
                                <h4>ูุงุทูุฉ ุจู ุณุงูู</h4>
                                <span>ุทุงูุจุฉ</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="testimonial-card">
                        <div class="testimonial-content">
                            <p>"ุงูุชุตููู ุฌููู ูููุงุณุจ ูุทุจูุนุฉ ุชุนูู ุงููุฑุขู. ุงูุฃููุงู ูุงุฏุฆุฉ ูุงูุฎุท ูุงุถุญ. ุชุฌุฑุจุฉ ูุฑูุญุฉ ููุนูู ูุงูููุณ."</p>
                        </div>
                        <div class="testimonial-author">
                            <div class="author-info">
                                <h4>ูุญูุฏ ุญุฑูุฏ</h4>
                                <span>ุฃุณุชุงุฐ ูุฑุขู ูุฑูู</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- CTA Section -->
        <section class="cta-section">
            <div class="section-content">
                <div class="cta-content">
                    <h3 class="cta-title">ุงุจุฏุฃ ุฑุญูุชู ุงูุชุนููููุฉ ุงูููู</h3>
                    <p class="cta-description">
                        ุงูุถู ุฅูู ุขูุงู ุงูุทูุงุจ ูุงูุฃุณุงุชุฐุฉ ุงูุฐูู ูุณุชุฎุฏููู ููุตุชูุง ูุชุนูู ูุชุนููู ุงููุฑุขู ุงููุฑูู
                    </p>
                    <div class="cta-actions">
                        <button class="btn btn-primary btn-large" onclick="showRegisterModal()">
                            ุฅูุดุงุก ุญุณุงุจ ูุฌุงูู
                        </button>
                        <button class="btn btn-outline btn-large" onclick="showLoginModal()">
                            ูุฏูู ุญุณุงุจุ ุณุฌู ุฏุฎููู
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="main-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <div class="logo-icon">๐</div>
                        <h4>ููุตุฉ ุชุนูู ุงููุฑุขู ุงููุฑูู</h4>
                    </div>
                    <p>ููุตุฉ ุชุนููููุฉ ูุชูุงููุฉ ูุชุนูู ูุชุนููู ุงููุฑุขู ุงููุฑูู ุจุฃุญุฏุซ ุงููุณุงุฆู ุงูุชูููุฉ</p>
                </div>
                
                <div class="footer-section">
                    <h4>ุฑูุงุจุท ุณุฑูุนุฉ</h4>
                    <ul class="footer-links">
                        <li><a href="#features">ุงููููุฒุงุช</a></li>
                        <li><a href="#how-it-works">ููู ุชุนูู</a></li>
                        <li><a href="#benefits">ุงูููุงุฆุฏ</a></li>
                        <li><a href="#testimonials">ุขุฑุงุก ุงููุณุชุฎุฏููู</a></li>
                    </ul>
                </div>
                
                <div class="footer-section">
                    <h4>ุชูุงุตู ูุนูุง</h4>
                    <div class="contact-info">
                        <p>๐ง amelloulou822@gmail.com </p>
                        <p>๐ 0556818359 </p>
                        
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; ูขููขูฅ ููุตุฉ ุชุนูู ุงููุฑุขู ุงููุฑูู. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
                <div class="footer-verse">
                    <span class="verse-text">ููููู ุฑููุจูู ุฒูุฏูููู ุนูููููุง</span>
                </div>
            </div>
        </footer>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ุชุณุฌูู ุงูุฏุฎูู</h3>
                <span class="close" onclick="closeModal('loginModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label for="loginEmail">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                        <input type="email" id="loginEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">ูููุฉ ุงููุฑูุฑ</label>
                        <input type="password" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">ุฏุฎูู</button>
                </form>
                
                <div class="divider">
                    <span>ุฃู</span>
                </div>
                
                <button id="googleSignIn" class="btn btn-google btn-full">
                    <img src="https://developers.google.com/identity/images/g-logo.png" alt="Google" class="google-icon">
                    ุชุณุฌูู ุงูุฏุฎูู ุจุฌูุฌู
                </button>
            </div>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ</h3>
                <span class="close" onclick="closeModal('registerModal')">&times;</span>
            </div>
            <div class="modal-body">
                <form id="registerForm">
                    <div class="form-group">
                        <label for="registerEmail">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
                        <input type="email" id="registerEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="registerPassword">ูููุฉ ุงููุฑูุฑ</label>
                        <input type="password" id="registerPassword" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="confirmPassword">ุชุฃููุฏ ูููุฉ ุงููุฑูุฑ</label>
                        <input type="password" id="confirmPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">ุฅูุดุงุก ุงูุญุณุงุจ</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Role Selection Modal -->
    <div id="roleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ุงุฎุชูุงุฑ ุงูุฏูุฑ</h3>
            </div>
            <div class="modal-body">
                <p>ุงูุฑุฌุงุก ุงุฎุชูุงุฑ ุฏูุฑู ูู ุงูููุตุฉ:</p>
                <div class="role-selection">
                    <button class="role-btn" onclick="selectRole('student')">
                        <div class="role-icon">๐</div>
                        <h4>ุทุงูุจ</h4>
                        <p>ููุชุนูู ููุชุงุจุนุฉ ุงูุฏุฑูุณ</p>
                    </button>
                    <button class="role-btn" onclick="selectRole('teacher')">
                        <div class="role-icon">๐จโ๐ซ</div>
                        <h4>ุฃุณุชุงุฐ</h4>
                        <p>ูุชุฏุฑูุณ ูุฅุฏุงุฑุฉ ุงูุทูุงุจ</p>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Profile Setup Modal -->
    <div id="profileModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ุฅููุงู ุงูููู ุงูุดุฎุตู</h3>
            </div>
            <div class="modal-body">
                <form id="profileForm">
                    <div class="form-group">
                        <label for="firstName">ุงูุงุณู ุงูุฃูู</label>
                        <input type="text" id="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">ุงุณู ุงูุนุงุฆูุฉ</label>
                        <input type="text" id="lastName" required>
                    </div>
                    <div class="form-group">
                        <label for="birthDate">ุชุงุฑูุฎ ุงููููุงุฏ</label>
                        <input type="date" id="birthDate" required>
                    </div>
                    <div id="teacherCode" class="form-group" style="display: none;">
                        <label for="accessCode">ุฑูุฒ ุงูุฏุฎูู (ููุฃุณุงุชุฐุฉ)</label>
                        <input type="password" id="accessCode" placeholder="ุฃุฏุฎู ุฑูุฒ ุงูุฏุฎูู">
                        <small>ุฑูุฒ ุงูุฏุฎูู ูุทููุจ ููุฃุณุงุชุฐุฉ ููุท</small>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">ุญูุธ ุงูุจูุงูุงุช</button>
                </form>
            </div>
        </div>
    </div>

    <div id="loading" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>ุฌุงุฑู ุงูุชุญููู...</p>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCO54SQWfIPTL4lWgAJObXQWcxF3RCPOEs",
            authDomain: "quran-8af1a.firebaseapp.com",
            projectId: "quran-8af1a",
            storageBucket: "quran-8af1a.firebasestorage.app",
            messagingSenderId: "898962069347",
            appId: "1:898962069347:web:bbb097e0a9acdce278e556",
            measurementId: "G-XE7LDEV3Q1"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const googleProvider = new GoogleAuthProvider();

        // Modal handling functions
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        window.showLoginModal = () => showModal('loginModal');
        window.showRegisterModal = () => showModal('registerModal');
        window.closeModal = closeModal;

        // Loading overlay functions
        function showLoading() {
            document.getElementById('loading').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }

        // Update navigation based on auth state
        async function updateNavigation(user) {
            const navActions = document.getElementById('navActions');
            if (user) {
                // Get user role from database
                const userData = await getUserData(user.uid);
                const dashboardUrl = userData?.role === 'teacher' ? 
                    'teacher-dashboard.html' : 'student-dashboard.html';
                
                navActions.innerHTML = `
                    <button class="btn btn-primary" onclick="window.location.href='${dashboardUrl}'">ููุญุฉ ุงูุชุญูู</button>
                    <button class="btn btn-outline" onclick="handleLogout()">ุชุณุฌูู ุงูุฎุฑูุฌ</button>
                `;
            } else {
                navActions.innerHTML = `
                    <button class="btn btn-outline" onclick="showLoginModal()">ุชุณุฌูู ุงูุฏุฎูู</button>
                    <button class="btn btn-primary" onclick="showRegisterModal()">ุฅูุดุงุก ุญุณุงุจ</button>
                `;
            }
        }

        // Handle logout
        window.handleLogout = async () => {
            try {
                await signOut(auth);
                // Redirect to home page or show success message
                window.location.href = '/';
            } catch (error) {
                alert('Error signing out: ' + error.message);
            }
        };

        // Listen for auth state changes
        onAuthStateChanged(auth, (user) => {
            updateNavigation(user);
        });

        // Add this function to get user data
        async function getUserData(userId) {
            try {
                const userDoc = await getDoc(doc(db, 'users', userId));
                if (userDoc.exists()) {
                    return userDoc.data();
                }
                return null;
            } catch (error) {
                console.error('Error getting user data:', error);
                return null;
            }
        }

        // Handle login form submission
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            showLoading();

            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const userData = await getUserData(userCredential.user.uid);
                
                if (userData) {
                    // Redirect based on role
                    window.location.href = userData.role === 'teacher' ? 
                        'teacher-dashboard.html' : 'student-dashboard.html';
                } else {
                    alert('User data not found');
                }
            } catch (error) {
                alert('Error logging in: ' + error.message);
            } finally {
                hideLoading();
            }
        });

        // Handle Google Sign In
        document.getElementById('googleSignIn').addEventListener('click', async () => {
            showLoading();
            try {
                const result = await signInWithPopup(auth, googleProvider);
                const userData = await getUserData(result.user.uid);
                if (userData) {
                    // Redirect based on role
                    window.location.href = userData.role === 'teacher' ? 
                        'teacher-dashboard.html' : 'student-dashboard.html';
                } else {
                    // If no role is set, show role selection modal
                    closeModal('loginModal');
                    showModal('roleModal');
                }
            } catch (error) {
                alert('Error signing in with Google: ' + error.message);
            } finally {
                hideLoading();
            }
        });

        // Handle registration form submission
        document.getElementById('registerForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            showLoading();

            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;

            if (password !== confirmPassword) {
                alert('Passwords do not match');
                hideLoading();
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                closeModal('registerModal');
                showModal('roleModal');
            } catch (error) {
                alert('Error creating account: ' + error.message);
            } finally {
                hideLoading();
            }
        });

        // Handle role selection
        window.selectRole = async (role) => {
            sessionStorage.setItem('selectedRole', role); // Store the selected role
            const user = auth.currentUser;
            if (!user) {
                alert('No user signed in');
                return;
            }

            try {
                await setDoc(doc(db, 'users', user.uid), {
                    role: role,
                    email: user.email,
                    createdAt: new Date().toISOString()
                });
                
                closeModal('roleModal');
                showModal('profileModal');
                
                // Show teacher code field if role is teacher
                document.getElementById('teacherCode').style.display = 
                    role === 'teacher' ? 'block' : 'none';
            } catch (error) {
                alert('Error setting role: ' + error.message);
            }
        };

        // Handle profile form submission
        document.getElementById('profileForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            showLoading();

            const user = auth.currentUser;
            if (!user) {
                alert('No user signed in');
                hideLoading();
                return;
            }

            const selectedRole = sessionStorage.getItem('selectedRole') || 'student';

            try {
                // For teachers, verify access code if needed
                if (selectedRole === 'teacher') {
                    const accessCode = document.getElementById('accessCode').value;
                    if (accessCode !== 'TEACHER123') {
                        alert('Invalid teacher access code');
                        hideLoading();
                        return;
                    }
                }

                await setDoc(doc(db, 'users', user.uid), {
                    firstName: document.getElementById('firstName').value,
                    lastName: document.getElementById('lastName').value,
                    birthDate: document.getElementById('birthDate').value,
                    email: user.email,
                    role: selectedRole,
                    createdAt: new Date(),
                    lastLogin: new Date()
                });

                // Redirect based on role after profile completion
                window.location.href = selectedRole === 'teacher' ? 
                    'teacher-dashboard.html' : 'student-dashboard.html';
                    
                // Clear the stored role after successful registration
                sessionStorage.removeItem('selectedRole');
            } catch (error) {
                alert('Error saving profile: ' + error.message);
            } finally {
                hideLoading();
            }
        });
    </script>
</body>
</html>